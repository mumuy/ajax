/*!
 * ajax.js v1.0.0
 * a mini ajax library
 * https://passer-by.com/ajax/
 *
 * Copyright (c) 2024-present, HaoLe Zheng
 *
 * Released under the MIT License
 * https://github.com/mumuy/ajax
 *
 * Created on: 2024-08-23
 */
function e(e,t){let a=Object.assign({},e,t);return new URLSearchParams(a).toString()}let t={};"undefined"!=typeof globalThis?t=globalThis:"undefined"!=typeof self?t=self:"undefined"!=typeof window?t=window:"undefined"!=typeof global&&(t=global);var a=t;async function n(t){let n=function(e){let t=Object.assign({method:"GET",url:location.origin,data:{},dataType:"json",headers:{},crossDomain:!1,cache:!0,timeout:5e3,jsonp:"callback",jsonpCallback:"jsonp_"+Date.now(),onTimeout:function(){}},e);return t.method=t.method.toUpperCase(),t.dataType=t.dataType.toLowerCase(),t}(t);return"jsonp"==n.dataType?async function(t){return new Promise((function(n,o){let s=document.getElementsByTagName("head")[0],r=document.createElement("script");s.appendChild(r),"jsonp"==t.dataType?a[t.jsonpCallback]=function(e){s.removeChild(r),delete a[t.jsonpCallback],l&&clearTimeout(l),n(e)}:r.onload=function(){l&&clearTimeout(l),n(json)};let d={};t.cache&&(d.v="_"+Date.now()),"jsonp"==t.dataType&&(d[t.jsonp]=t.jsonpCallback);let i=e(t.data,d);i&&(t.url+=(t.url.includes("?")?"&":"?")+i),r.src=t.url;let l=setTimeout((function(){s.removeChild(r),delete a[t.jsonpCallback],l&&clearTimeout(l),t.onTimeout(),o({msg:"timeout"})}),t.timeout)}))}(n):"undefined"!=typeof XMLHttpRequest?async function(t){return new Promise((function(a,n){let o=new XMLHttpRequest;"object"==typeof t.data&&t.data instanceof FormData&&(t.method="POST");for(let e in t.headers)o.setRequestHeader(e,t.headers[e]);if(o.crossDomain=t.crossDomain,o.withCredentials=!0,"GET"==t.method){let a={};t.cache&&(a.v="_"+Date.now());let n=t.url,s=e(t.data,a);s&&(n+=(n.includes("?")?"&":"?")+s),o.open(t.method,n,!0),o.send(null)}else{o.open(t.method,t.url,!0);let e=t.data;t.data instanceof FormData?o.setRequestHeader("content-type","multipart/form-data"):"object"==typeof t.data?(o.setRequestHeader("content-type","application/json"),e=JSON.stringify(t.data)):o.setRequestHeader("content-type","application/x-www-form-urlencoded"),o.send(e)}let s=!1,r=setTimeout((function(){s=!0,4!=o.readyState&&(o.abort(),t.onTimeout(),n(new Error("timeout")))}),t.timeout);o.addEventListener("loadend",(()=>{if(!s){if(o.status>=200&&o.status<300||304==o.status){let e="xml"==t.dataType?o.responseXML:o.responseText;"json"==t.dataType&&(e=JSON.parse(e)),a(e)}else n(new Error(o.response));r&&clearTimeout(r)}}))}))}(n):"undefined"!=typeof fetch?async function(t){let a=t.url,n={credentials:"same-origin"};if(n.headers=t.headers,n.cache=t.cache,n.mode=t.crossDomain?"cors":"no-cors","GET"==t.method){let n=e(t.data,patch);n&&(a+=(a.includes("?")?"&":"?")+n)}else"POST"==t.method&&(n.body=t.data,t.data instanceof FormData?n.headers["Content-Type"]="multipart/form-data":"object"==typeof t.data?(n.headers["Content-Type"]="application/json",n.body=JSON.stringify(t.data)):n.headers["Content-Type"]="application/x-www-form-urlencoded");let o=setTimeout((function(){t.onTimeout()}),t.timeout);return fetch(a,n).then((function(e){return o&&clearTimeout(o),"json"==dataType?e.json():e.text()}))}(n):Promise.resolve(new Error("fail"))}n.get=async function(e,t,a="json"){return n({method:"GET",url:e,data:t,dataType:a})},n.post=async function(e,t){return n({method:"POST",url:e,data:t})};export{n as default};
