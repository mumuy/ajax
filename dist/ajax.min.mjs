/*!
 * ajax.js v1.0.0
 * a mini ajax library
 * https://passer-by.com/ajax/
 *
 * Copyright (c) 2024-present, HaoLe Zheng
 *
 * Released under the MIT License
 * https://github.com/mumuy/ajax
 *
 * Created on: 2025-07-04
 */
function e(e,t){let n=Object.assign({},e,t);return new URLSearchParams(n).toString()}let t={};"undefined"!=typeof globalThis?t=globalThis:"undefined"!=typeof self?t=self:"undefined"!=typeof window?t=window:"undefined"!=typeof global&&(t=global);var n=t;async function a(t){let a=Object.assign({},o,function(e){let t=Object.assign({method:"GET",url:location.origin,data:{},dataType:"json",headers:{},crossDomain:!1,credentials:!1,cache:!0,timeout:5e3,jsonp:"callback",jsonpCallback:"jsonp_"+Date.now(),onTimeout:function(){}},e);return t.method=t.method.toUpperCase(),t.dataType=t.dataType.toLowerCase(),t}(t));return"jsonp"==a.dataType?async function(t){return new Promise((function(a,o){let s=document.getElementsByTagName("head")[0],r=document.createElement("script");s.appendChild(r),"jsonp"==t.dataType?n[t.jsonpCallback]=function(e){s.removeChild(r),delete n[t.jsonpCallback],l&&clearTimeout(l),a(e)}:r.onload=function(){l&&clearTimeout(l),a(json)};let i={};t.cache&&(i.v="_"+Date.now()),"jsonp"==t.dataType&&(i[t.jsonp]=t.jsonpCallback);let d=e(t.data,i);d&&(t.url+=(t.url.includes("?")?"&":"?")+d),r.src=t.url;let l=setTimeout((function(){s.removeChild(r),delete n[t.jsonpCallback],l&&clearTimeout(l),t.onTimeout(),o({msg:"timeout"})}),t.timeout)}))}(a):"undefined"!=typeof XMLHttpRequest?async function(t){return new Promise((function(n,a){let o=new XMLHttpRequest;"object"==typeof t.data&&t.data instanceof FormData&&(t.method="POST");for(let e in t.headers)o.setRequestHeader(e,t.headers[e]);if(o.crossDomain=t.crossDomain,o.withCredentials=t.credentials,"GET"==t.method){let n={};t.cache&&(n.v="_"+Date.now());let a=t.url,s=e(t.data,n);s&&(a+=(a.includes("?")?"&":"?")+s),o.open(t.method,a,!0),o.send(null)}else{o.open(t.method,t.url,!0);let e=t.data;t.data instanceof FormData?o.setRequestHeader("content-type","multipart/form-data"):"object"==typeof t.data?(o.setRequestHeader("content-type","application/json"),e=JSON.stringify(t.data)):o.setRequestHeader("content-type","application/x-www-form-urlencoded"),o.send(e)}let s=!1,r=setTimeout((function(){s=!0,4!=o.readyState&&(o.abort(),t.onTimeout(),a(new Error("timeout")))}),t.timeout);o.addEventListener("loadend",(()=>{if(!s){if(o.status>=200&&o.status<300||304==o.status){let e="xml"==t.dataType?o.responseXML:o.responseText;"json"==t.dataType&&(e=JSON.parse(e)),n(e)}else a(new Error(o.response));r&&clearTimeout(r)}}))}))}(a):"undefined"!=typeof fetch?async function(t){let n=t.url,a={};if(a.credentials=t.credentials?"include":"same-origin",a.headers=t.headers,a.cache=t.cache,a.mode=t.crossDomain?"cors":"no-cors","GET"==t.method){let a=e(t.data,patch);a&&(n+=(n.includes("?")?"&":"?")+a)}else"POST"==t.method&&(a.body=t.data,t.data instanceof FormData?a.headers["Content-Type"]="multipart/form-data":"object"==typeof t.data?(a.headers["Content-Type"]="application/json",a.body=JSON.stringify(t.data)):a.headers["Content-Type"]="application/x-www-form-urlencoded");const o=new AbortController,s=o.signal;let r=setTimeout((function(){o.abort(),t.onTimeout()}),t.timeout);return fetch(n,{...a,signal:s}).then((function(e){return r&&clearTimeout(r),"json"==dataType?e.json():e.text()}))}(a):Promise.resolve(new Error("fail"))}const o={};a.setConfig=function(e){Object.assign(o,e)},a.get=async function(e,t,n="json"){return a({method:"GET",url:e,data:t,dataType:n})},a.post=async function(e,t){return a({method:"POST",url:e,data:t})};export{a as default};
