/*!
 * ajax.js v1.0.0
 * a mini ajax library
 * https://passer-by.com/ajax/
 *
 * Copyright (c) 2024-present, HaoLe Zheng
 *
 * Released under the MIT License
 * https://github.com/mumuy/ajax
 *
 * Created on: 2025-07-11
 */
var e={baseURL:"",method:"GET",url:location.origin,data:{},dataType:"json",headers:{},crossDomain:!0,cache:!1,timeout:5e3,jsonp:"callback",jsonpCallback:"jsonp_"+Date.now(),onTimeout:function(){}};class t{constructor(){this.handlers=[]}add(e,t){return this.handlers.push({resolved:e,rejected:t}),this.handlers.length-1}remove(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers=[]}forEach(e){this.handlers.forEach((function(t){e(t)}))}}function n(e,t={}){let n=Object.assign({},e,t);return new URLSearchParams(n).toString()}let o={};"undefined"!=typeof globalThis?o=globalThis:"undefined"!=typeof self?o=self:"undefined"!=typeof window?o=window:"undefined"!=typeof global&&(o=global);var a=o;async function s(e){let t=null;return t="jsonp"==e.dataType?await async function(e){return new Promise((function(t,o){let s=document.getElementsByTagName("head")[0],r=document.createElement("script");s.appendChild(r),"jsonp"==e.dataType?a[e.jsonpCallback]=function(n){s.removeChild(r),delete a[e.jsonpCallback],d&&clearTimeout(d),t(n)}:r.onload=function(){d&&clearTimeout(d),t(json)};let i={};e.cache&&(i.v="_"+Date.now()),"jsonp"==e.dataType&&(i[e.jsonp]=e.jsonpCallback);let c=n(e.data,i);c&&(e.url+=(e.url.includes("?")?"&":"?")+c),r.src=e.url;let d=setTimeout((function(){s.removeChild(r),delete a[e.jsonpCallback],d&&clearTimeout(d),e.onTimeout(),o({msg:"timeout"})}),e.timeout)}))}(e):"undefined"!=typeof fetch?await async function(e){let t=e.url,o={credentials:"same-origin"};if(e.credentials,o.headers=e.headers,o.cache=e.cache?"default":"no-store",o.mode=e.crossDomain?"cors":"no-cors","GET"==e.method){let o=n(e.data);o&&(t+=(t.includes("?")?"&":"?")+o)}else"POST"==e.method&&(o.body=e.data,e.data instanceof FormData?o.headers["Content-Type"]="multipart/form-data":"object"==typeof e.data?(o.headers["Content-Type"]="application/json",o.body=JSON.stringify(e.data)):o.headers["Content-Type"]="application/x-www-form-urlencoded");const a=new AbortController,s=a.signal;let r=setTimeout((function(){a.abort(),e.onTimeout()}),e.timeout);return fetch(t,{...o,signal:s}).then((function(t){return r&&clearTimeout(r),"json"==e.dataType?t.json():t.text()}))}(e):"undefined"!=typeof XMLHttpRequest?await async function(e){return new Promise((function(t,o){let a=new XMLHttpRequest;"object"==typeof e.data&&e.data instanceof FormData&&(e.method="POST");for(let t in e.headers)a.setRequestHeader(t,e.headers[t]);if(a.crossDomain=e.crossDomain,a.withCredentials=e.credentials,"GET"==e.method){let t={};e.cache&&(t.v="_"+Date.now());let o=e.url,s=n(e.data,t);s&&(o+=(o.includes("?")?"&":"?")+s),a.open(e.method,o,!0),a.send(null)}else{a.open(e.method,e.url,!0);let t=e.data;e.data instanceof FormData?a.setRequestHeader("content-type","multipart/form-data"):"object"==typeof e.data?(a.setRequestHeader("content-type","application/json"),t=JSON.stringify(e.data)):a.setRequestHeader("content-type","application/x-www-form-urlencoded"),a.send(t)}let s=!1,r=setTimeout((function(){s=!0,4!=a.readyState&&(a.abort(),e.onTimeout(),o(new Error("timeout")))}),e.timeout);a.addEventListener("loadend",(()=>{if(!s){if(a.status>=200&&a.status<300||304==a.status){let n="xml"==e.dataType?a.responseXML:a.responseText;"json"==e.dataType&&(n=JSON.parse(n)),t(n)}else o(new Error(a.response));r&&clearTimeout(r)}}))}))}(e):new Error("fail"),t}class r{constructor(e){this.defaults=e,this.interceptors={request:new t,response:new t}}async request(e,t){const n={};"string"==typeof e?Object.assign(n,this.defaults,{url:e},t):Object.assign(n,this.defaults,e),0!==n.url.indexOf("http")&&(n.url=n.baseURL+n.url),n.method=n.method.toUpperCase(),n.dataType=n.dataType.toLowerCase();const o=[];this.interceptors.request.forEach((function(e){o.unshift(e.resolved,e.rejected)}));const a=[];this.interceptors.response.forEach((function(e){a.push(e.resolved,e.rejected)}));const r=[s.bind(this),void 0];r.unshift(...o),r.push(...a);let i=0,c=r.length,d=Promise.resolve(n);for(;i<c;)d=d.then(r[i++],r[i++]);return d}}function i(e,...t){return t.forEach((t=>{const n=Object.getOwnPropertyDescriptors(t);Object.defineProperties(e,n)})),e}["get","post","head","options"].forEach((function(e){r.prototype[e]=function(t,n,o){return this.request({method:e,url:t,data:n,...o})}})),["delete","head","options"].forEach((function(e){r.prototype[e]=function(t,n){return this.request({method:e,url:t,data:null,...n})}}));const c=function e(t){const n=new r(t),o=r.prototype.request.bind(n);return i(o,r.prototype,n),i(o,n),o.create=function(n){return e(Object.assign(t,n))},o}(e);export{c as default};
