/*!
 * ajax.js v1.0.0
 * a mini ajax library
 * https://passer-by.com/ajax/
 *
 * Copyright (c) 2024-present, HaoLe Zheng
 *
 * Released under the MIT License
 * https://github.com/mumuy/ajax
 *
 * Created on: 2024-12-17
 */
function e(e,t){let n=Object.assign({},e,t);return new URLSearchParams(n).toString()}let t={};"undefined"!=typeof globalThis?t=globalThis:"undefined"!=typeof self?t=self:"undefined"!=typeof window?t=window:"undefined"!=typeof global&&(t=global);var n=t;async function o(t){let o=function(e){let t=Object.assign({method:"GET",url:location.origin,data:{},dataType:"json",headers:{},crossDomain:!1,cache:!0,timeout:5e3,jsonp:"callback",jsonpCallback:"jsonp_"+Date.now(),onTimeout:function(){}},e);return t.method=t.method.toUpperCase(),t.dataType=t.dataType.toLowerCase(),t}(t);return"jsonp"==o.dataType?async function(t){return new Promise((function(o,a){let s=document.getElementsByTagName("head")[0],r=document.createElement("script");s.appendChild(r),"jsonp"==t.dataType?n[t.jsonpCallback]=function(e){s.removeChild(r),delete n[t.jsonpCallback],l&&clearTimeout(l),o(e)}:r.onload=function(){l&&clearTimeout(l),o(json)};let i={};t.cache&&(i.v="_"+Date.now()),"jsonp"==t.dataType&&(i[t.jsonp]=t.jsonpCallback);let d=e(t.data,i);d&&(t.url+=(t.url.includes("?")?"&":"?")+d),r.src=t.url;let l=setTimeout((function(){s.removeChild(r),delete n[t.jsonpCallback],l&&clearTimeout(l),t.onTimeout(),a({msg:"timeout"})}),t.timeout)}))}(o):"undefined"!=typeof XMLHttpRequest?async function(t){return new Promise((function(n,o){let a=new XMLHttpRequest;"object"==typeof t.data&&t.data instanceof FormData&&(t.method="POST");for(let e in t.headers)a.setRequestHeader(e,t.headers[e]);if(a.crossDomain=t.crossDomain,a.withCredentials=!0,"GET"==t.method){let n={};t.cache&&(n.v="_"+Date.now());let o=t.url,s=e(t.data,n);s&&(o+=(o.includes("?")?"&":"?")+s),a.open(t.method,o,!0),a.send(null)}else{a.open(t.method,t.url,!0);let e=t.data;t.data instanceof FormData?a.setRequestHeader("content-type","multipart/form-data"):"object"==typeof t.data?(a.setRequestHeader("content-type","application/json"),e=JSON.stringify(t.data)):a.setRequestHeader("content-type","application/x-www-form-urlencoded"),a.send(e)}let s=!1,r=setTimeout((function(){s=!0,4!=a.readyState&&(a.abort(),t.onTimeout(),o(new Error("timeout")))}),t.timeout);a.addEventListener("loadend",(()=>{if(!s){if(a.status>=200&&a.status<300||304==a.status){let e="xml"==t.dataType?a.responseXML:a.responseText;"json"==t.dataType&&(e=JSON.parse(e)),n(e)}else o(new Error(a.response));r&&clearTimeout(r)}}))}))}(o):"undefined"!=typeof fetch?async function(t){let n=t.url,o={credentials:"same-origin"};if(o.headers=t.headers,o.cache=t.cache,o.mode=t.crossDomain?"cors":"no-cors","GET"==t.method){let o=e(t.data,patch);o&&(n+=(n.includes("?")?"&":"?")+o)}else"POST"==t.method&&(o.body=t.data,t.data instanceof FormData?o.headers["Content-Type"]="multipart/form-data":"object"==typeof t.data?(o.headers["Content-Type"]="application/json",o.body=JSON.stringify(t.data)):o.headers["Content-Type"]="application/x-www-form-urlencoded");const a=new AbortController,s=a.signal;let r=setTimeout((function(){a.abort(),t.onTimeout()}),t.timeout);return fetch(n,{...o,signal:s}).then((function(e){return r&&clearTimeout(r),"json"==dataType?e.json():e.text()}))}(o):Promise.resolve(new Error("fail"))}o.get=async function(e,t,n="json"){return o({method:"GET",url:e,data:t,dataType:n})},o.post=async function(e,t){return o({method:"POST",url:e,data:t})};export{o as default};
