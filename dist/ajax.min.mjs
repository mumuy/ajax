/*!
 * ajax.js v1.0.0
 * a mini ajax library
 * https://passer-by.com/ajax/
 *
 * Copyright (c) 2024-present, HaoLe Zheng
 *
 * Released under the MIT License
 * https://github.com/mumuy/ajax
 *
 * Created on: 2025-07-11
 */
var e={baseURL:location.origin,method:"GET",url:"",data:{},headers:{},crossDomain:!1,cache:!0,timeout:5e3,jsonp:"callback",jsonpCallback:"jsonp_"+Date.now(),responseType:"json",dataFormatter:null,onTimeout:function(){}};class t{constructor(){this.handlers=[]}add(e,t){return this.handlers.push({resolved:e,rejected:t}),this.handlers.length-1}remove(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers=[]}forEach(e){this.handlers.forEach((function(t){e(t)}))}}function n(e,t={}){let n=Object.assign({},e,t);return new URLSearchParams(n).toString()}function o(e,t=""){const n=[];for(const[s,r]of Object.entries(e)){const e=t?` ${t}[${s}]`:s;r instanceof Object&&!Array.isArray(r)?n.push(o(r,e)):Array.isArray(r)?r.forEach(((t,s)=>{t instanceof Object?n.push(o(t,`${e}[${s}]`)):n.push(`${encodeURIComponent(e)}[]=${encodeURIComponent(t)}`)})):n.push(`${encodeURIComponent(e)}=${encodeURIComponent(r)}`)}return n.join("&")}function s(e){return null!=e&&("object"==typeof e||"function"==typeof e)}function r(e,t,r){if(t["Content-Type"]||(e instanceof FormData?t["Content-Type"]="multipart/form-data":s(e)?t["Content-Type"]="application/json":!function(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof DataView}(e)?t["Content-Type"]="application/x-www-form-urlencoded":t["Content-Type"]="application/octet-stream"),r){if(!s(r))return r(e,t);if(t["Content-Type"].includes("application/x-www-form-urlencoded"))return"brackets"==r.arrayFormat?o(e):n(e)}return t["Content-Type"].includes("application/json")?JSON.stringify(config.data):t["Content-Type"].includes("application/x-www-form-urlencoded")?n(e):e}let a={};"undefined"!=typeof globalThis?a=globalThis:"undefined"!=typeof self?a=self:"undefined"!=typeof window?a=window:"undefined"!=typeof global&&(a=global);var i=a;async function c(e){let t=null;return t="jsonp"==e.responseType?await async function(e){return new Promise((function(t,o){let s=document.getElementsByTagName("head")[0],r=document.createElement("script");s.appendChild(r),"jsonp"==e.responseType?i[e.jsonpCallback]=function(n){s.removeChild(r),delete i[e.jsonpCallback],u&&clearTimeout(u),t(n)}:r.onload=function(){u&&clearTimeout(u),t(json)};let a={};e.cache&&(a.v="_"+Date.now()),"jsonp"==e.responseType&&(a[e.jsonp]=e.jsonpCallback);let c=n(e.data,a);c&&(e.url+=(e.url.includes("?")?"&":"?")+c),r.src=e.url;let u=setTimeout((function(){s.removeChild(r),delete i[e.jsonpCallback],u&&clearTimeout(u),e.onTimeout(),o({msg:"timeout"})}),e.timeout)}))}(e):"undefined"!=typeof fetch?await async function(e){let t=e.url;const o={method:e.method,credentials:e.crossDomain?"include":"same-origin",headers:e.headers,cache:e.cache?"default":"no-store",mode:e.crossDomain?"cors":"no-cors"};if("GET"==e.method){let o=n(e.data);o&&(t+=(t.includes("?")?"&":"?")+o)}else"POST"==e.method&&(o.body=r(e.data,o.headers,e.dataFormatter));let s=setTimeout((function(){e.onTimeout()}),e.timeout);return fetch(t,o).then((function(t){return s&&clearTimeout(s),"json"==e.responseType?t.json?t.json():{}:t.text?t.text():""}))}(e):"undefined"!=typeof XMLHttpRequest?await async function(e){return new Promise((function(t,o){let s=new XMLHttpRequest;"object"==typeof e.data&&e.data instanceof FormData&&(e.method="POST");for(let t in e.headers)s.setRequestHeader(t,e.headers[t]);if(s.crossDomain=e.crossDomain,s.withCredentials=e.credentials,"GET"==e.method){let t={};e.cache&&(t.v="_"+Date.now());let o=e.url,r=n(e.data,t);r&&(o+=(o.includes("?")?"&":"?")+r),s.open(e.method,o,!0),s.send(null)}else{s.open(e.method,e.url,!0);const t=transformRequest(e.data,e.headers,e.dataFormatter);s.setRequestHeader("Content-Type",e.headers["Content-Type"]),s.send(t)}let r=!1,a=setTimeout((function(){r=!0,4!=s.readyState&&(s.abort(),e.onTimeout(),o(new Error("timeout")))}),e.timeout);s.addEventListener("loadend",(()=>{if(!r){if(s.status>=200&&s.status<300||304==s.status){let n="xml"==e.responseType?s.responseXML:s.responseText;"json"==e.responseType&&(n=JSON.parse(n)),t(n)}else o(new Error(s.response));a&&clearTimeout(a)}}))}))}(e):new Error("fail"),t}class u{constructor(n={}){this.defaults=Object.assign({},e,n),this.interceptors={request:new t,response:new t}}async request(e,t){const n={};"string"==typeof e?Object.assign(n,this.defaults,{url:e},t):Object.assign(n,this.defaults,e),0!==n.url.indexOf("http")&&(n.url=n.baseURL+n.url),n.method=n.method.toUpperCase(),n.responseType=n.responseType.toLowerCase();const o=[];this.interceptors.request.forEach((function(e){o.unshift(e.resolved,e.rejected)}));const s=[];this.interceptors.response.forEach((function(e){s.push(e.resolved,e.rejected)}));const r=[c.bind(this),void 0];r.unshift(...o),r.push(...s);let a=0,i=r.length,u=Promise.resolve(n);for(;a<i;)u=u.then(r[a++],r[a++]);return u}}["get","post","head","options"].forEach((function(e){u.prototype[e]=function(t,n,o){return this.request({method:e,url:t,data:n,...o})}})),["delete","head","options"].forEach((function(e){u.prototype[e]=function(t,n){return this.request({method:e,url:t,data:null,...n})}}));const l=function e(t={}){const n=new u(t),o=u.prototype.request.bind(n);return function(e,...t){t.forEach((t=>{const n=Object.getOwnPropertyDescriptors(t);Object.defineProperties(e,n)}))}(o,u.prototype,n),o.create=function(n){return e(Object.assign(t,n))},o}();export{l as default};
