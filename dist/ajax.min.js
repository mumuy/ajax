/*!
 * ajax.js v1.1.0
 * a mini ajax library
 * https://passer-by.com/ajax/
 *
 * Copyright (c) 2024-present, HaoLe Zheng
 *
 * Released under the MIT License
 * https://github.com/mumuy/ajax
 *
 * Created on: 2025-07-30
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ajax=t()}(this,(function(){"use strict";var e={baseURL:location.origin,method:"GET",url:"",data:{},headers:{},withCredentials:!1,crossDomain:!1,cache:!0,timeout:5e3,jsonp:"callback",jsonpCallback:"jsonp_"+Date.now(),responseType:"json",dataFormatter:null,onTimeout:function(){}};function t(e){return null!=e&&("object"==typeof e||"function"==typeof e)}function n(e){return"string"==typeof e}function r(e){return Array.isArray(e)}function o(e){return e instanceof FormData}class s{constructor(){this.handlers=[]}add(e,t){return this.handlers.push({resolved:e,rejected:t}),this.handlers.length-1}remove(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers=[]}forEach(e){this.handlers.forEach((function(t){e(t)}))}}function a(e,t={}){let n=Object.assign({},e,t);return new URLSearchParams(n).toString()}function i(e,n=""){const o=[];for(const[s,a]of Object.entries(e)){const e=n?` ${n}[${s}]`:s;t(a)?o.push(i(a,e)):r(a)?a.forEach(((t,n)=>{t instanceof Object?o.push(i(t,`${e}[${n}]`)):o.push(`${encodeURIComponent(e)}[]=${encodeURIComponent(t)}`)})):o.push(`${encodeURIComponent(e)}=${encodeURIComponent(a)}`)}return o.join("&")}function c(e){return n(e)?(new DOMParser).parseFromString(e,"application/xml"):function(e){return e instanceof Element}(e)?e:null}function l(e,r,s){if(r["Content-Type"]||(o(e)?r["Content-Type"]="multipart/form-data":e instanceof URLSearchParams?r["Content-Type"]="application/x-www-form-urlencoded":!function(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof DataView}(e)?t(e)?r["Content-Type"]="application/json":!function(e){return"string"==typeof e&&/^<([a-z]+)([^<]+)*(?:>(.*)<\/\1>|\s+\/>)$/i.test(e)}(e)?r["Content-Type"]="text/plain":r["Content-Type"]="application/xml":r["Content-Type"]="application/octet-stream"),s){if(!t(s))return s(e,r);if(r["Content-Type"].includes("application/x-www-form-urlencoded"))return"brackets"==s.arrayFormat?i(e):a(e)}return r["Content-Type"].includes("application/json")&&t(e)?JSON.stringify(config.data):r["Content-Type"].includes("application/x-www-form-urlencoded")&&t(e)?a(e):r["Content-Type"].includes("application/xml")&&n(e)?c(e):e}let u={};"undefined"!=typeof globalThis?u=globalThis:"undefined"!=typeof self?u=self:"undefined"!=typeof window?u=window:"undefined"!=typeof global&&(u=global);var d=u;async function p(e){let t=null;return t="jsonp"==e.responseType?await async function(e){return new Promise((function(t,n){let r=document.getElementsByTagName("head")[0],o=document.createElement("script");r.appendChild(o),o.setAttribute("referrerPolicy","no-referrer"),"jsonp"==e.responseType?d[e.jsonpCallback]=function(n){r.removeChild(o),delete d[e.jsonpCallback],c&&clearTimeout(c),t(n)}:o.onload=function(){c&&clearTimeout(c),t(json)};let s={};e.cache&&(s.v="_"+Date.now()),"jsonp"==e.responseType&&(s[e.jsonp]=e.jsonpCallback);let i=a(e.data,s);i&&(e.url+=(e.url.includes("?")?"&":"?")+i),o.src=e.url;let c=setTimeout((function(){r.removeChild(o),delete d[e.jsonpCallback],c&&clearTimeout(c),e.onTimeout(),n({msg:"timeout"})}),e.timeout)}))}(e):"undefined"!=typeof fetch?await async function(e){let t=e.url;const n={method:e.method,credentials:"omit",headers:e.headers,cache:e.cache?"default":"no-store",mode:e.crossDomain?"cors":"no-cors"};if(e.withCredentials&&(n.credentials=e.crossDomain?"include":"same-origin"),"GET"==e.method){let n=a(e.data);n&&(t+=(t.includes("?")?"&":"?")+n)}else"POST"==e.method&&(n.body=l(e.data,n.headers,e.dataFormatter));let r=setTimeout((function(){e.onTimeout()}),e.timeout);return fetch(t,n).then((function(t){return r&&clearTimeout(r),"stream"==e.responseType?t.body:"json"==e.responseType&&t.json?t.json():"text"==e.responseType&&t.text?t.text():"xml"==e.responseType&&t.text?c(t.text()):t.blob()}))}(e):"undefined"!=typeof XMLHttpRequest?await async function(e){return new Promise((function(t,n){let r=new XMLHttpRequest;o(e.data)&&(e.method="POST");for(let t in e.headers)r.setRequestHeader(t,e.headers[t]);if(r.crossDomain=e.crossDomain,r.withCredentials=e.withCredentials,"GET"==e.method){let t={};e.cache&&(t.v="_"+Date.now());let n=e.url,o=a(e.data,t);o&&(n+=(n.includes("?")?"&":"?")+o),r.open(e.method,n,!0),r.send(null)}else{r.open(e.method,e.url,!0);const t=transformRequest(e.data,e.headers,e.dataFormatter);r.setRequestHeader("Content-Type",e.headers["Content-Type"]),r.send(t)}let s=!1,i=setTimeout((function(){s=!0,4!=r.readyState&&(r.abort(),e.onTimeout(),n(new Error("timeout")))}),e.timeout);r.addEventListener("loadend",(()=>{if(!s){if(r.status>=200&&r.status<300||304==r.status){let n="xml"==e.responseType?r.responseXML:r.responseText;"json"==e.responseType&&(n=JSON.parse(n)),t(n)}else n(new Error(r.response));i&&clearTimeout(i)}}))}))}(e):new Error("fail"),t}class h{static CONNECTING=0;static OPEN=1;static CLOSED=2;#e=new Map;#t=null;constructor(e,t){const n=this;n.url=t.url,n.withCredentials=t.withCredentials||!1,n.readyState=h.CONNECTING,n.onopen=function(){},n.onmessage=function(){},n.onerror=function(){},n.#t=t.controller,e().then((function(e){n.#n(e)}))}async#n(e){const t=e.getReader(),n=new TextDecoder;let r="";const o=this;try{for(;;){this.readyState=h.OPEN;const{done:e,value:s}=await t.read();if(e&&(this.readyState=h.CONNECTING,o.dispatchEvent({type:"error",msg:""})),this.readyState===h.CLOSED)break;r+=n.decode(s,{stream:!0});const a=r.split("\n\n");r=a.pop()||"",a.forEach((e=>{if(e.trim()){const t={type:"message",data:"",id:null,retry:null};e.split("\n").forEach((e=>{if(!e.trim()||e.startsWith(":"))return;const[n,...r]=e.split(":"),o=r.join(":").trimStart();switch(n){case"event":t.type=o;break;case"data":t.data+=(t.data?"\n":"")+(o||"");break;case"id":t.id=o;break;case"retry":t.retry=parseInt(o,10)}})),t.data&&(t.data=t.data.replace(/\n$/,""),o.dispatchEvent(t))}}))}}finally{t.releaseLock()}}dispatchEvent(e){this.#e.has(e.type)&&this.readyState!==h.CLOSED&&this.#e.get(e.type).forEach((t=>{t(e)})),this["on"+e.type]&&this["on"+e.type](e)}addEventListener(e,t){return this.#e.has(e)||this.#e.set(e,[]),this.#e.get(e).push(t),this}removeEventListener(e,t){return this.#e.has(e)&&this.#e.set(e,this.#e.get(e).filter((e=>e!==t))),this}close(){this.readyState!==h.CLOSED&&(this.readyState=h.CLOSED,this.#t&&this.#t.abort(),this.dispatchEvent({type:"error",error:new Error("Connection closed")}))}}class f{constructor(t={}){this.defaults=Object.assign({},e,t),this.interceptors={request:new s,response:new s}}async request(e,t){const r={};n(e)?Object.assign(r,this.defaults,{url:e},t):Object.assign(r,this.defaults,e),r.url.startsWith("http")||(r.url=r.baseURL+r.url),r.method=r.method.toUpperCase(),r.responseType=r.responseType.toLowerCase();const o=[];this.interceptors.request.forEach((function(e){o.unshift(e.resolved,e.rejected)}));const s=[];this.interceptors.response.forEach((function(e){s.push(e.resolved,e.rejected)}));const a=[p.bind(this),void 0];a.unshift(...o),a.push(...s);let i=0,c=a.length,l=Promise.resolve(r);for(;i<c;)l=l.then(a[i++],a[i++]);return l}async jsonp(e,t,n){return this.request({method:"GET",url:e,data:t,...n,responseType:"jsonp"})}createEventSource(e,t){const n=this,r=new AbortController,o=Object.assign({},n.defaults,t,{url:e,method:"GET",headers:{Accept:"text/event-stream"},responseType:"stream",signal:r.signal});return new h((function(){return n.request(o)}),{...o,controller:r})}}["get","post","push","patch"].forEach((function(e){f.prototype[e]=function(t,n,r){return this.request({method:e,url:t,data:n,...r})}})),["delete","head","options"].forEach((function(e){f.prototype[e]=function(t,n){return this.request({method:e,url:t,data:null,...n})}}));const m=function e(t={}){const n=new f(t),r=f.prototype.request.bind(n);return function(e,...t){t.forEach((t=>{const n=Object.getOwnPropertyDescriptors(t);Object.defineProperties(e,n)}))}(r,f.prototype,n),r.create=function(n){return e(Object.assign(t,n))},r}();return m}));
